

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Primer to HDF5 and h5py &mdash; sidpy 0.12.8 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/documentation_options.js?v=425f82fe"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Utilities for reading h5USID files" href="hdf_utils_read.html" />
    <link rel="prev" title="HDF5 Tools" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            sidpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SIDpy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../external_guides.html">Tutorials on Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">Guidelines for Contribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matlab.html">Upgrading from Matlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact us</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/sidpy.html">sidpy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../00_basic_usage/index.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_parallel_computing/index.html">Parallel computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_visualization/index.html">Visualization</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">HDF5 Tools</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Primer to HDF5 and h5py</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Import-all-necessary-packages">Import all necessary packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Groups">Groups</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create_group()">create_group()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Groups-in-Groups">Groups in Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#.parent">.parent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Accessing-H5-objects">Accessing H5 objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#.items()">.items()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Datasets">Datasets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create_dataset()">create_dataset()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Creating-Dataset-with-available-data:">Creating Dataset with available data:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Accessing-data">Accessing data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Creating-(potentially-large)-empty-datasets:">Creating (potentially large) empty datasets:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#populating-with-data">populating with data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flush()">flush()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Creating-resizeable-datasets:">Creating resizeable datasets:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Attributes">Attributes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Writing">Writing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reading">Reading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Caveat">Caveat</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hdf_utils_read.html">Utilities for reading h5USID files</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">sidpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">HDF5 Tools</a></li>
      <li class="breadcrumb-item active">Primer to HDF5 and h5py</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/03_hdf5/h5py_primer.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<section id="Primer-to-HDF5-and-h5py">
<h1>Primer to HDF5 and h5py<a class="headerlink" href="#Primer-to-HDF5-and-h5py" title="Link to this heading">¶</a></h1>
<p><strong>Suhas Somnath</strong></p>
<p>4/18/2018</p>
<p><strong>This document serves as a quick primer to HDF5 files and the h5py package used for reading and writing to such files</strong></p>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link to this heading">¶</a></h2>
<p>We create and consume digital information stored in various file formats on a daily basis such as news presented in HTML files, scientific journal articles in PDF files, tabular data in XLSX spreadsheets and so on. Commercially available scientific instruments generate data in a variety of, typically proprietary, file formats. The proprietary nature of the data impedes scientific research of individual researchers and the collaboration within the scientific community at large. Hence, pycroscopy
stores all relevant information including the measurement data, metadata etc. in the most popular file format for scientific data - Hierarchical Data Format (HDF5) files.</p>
<p>HDF5 is a remarkably straightforward file format to understand since it mimics the familiar folders and files paradigm exposed to users by all operating systems such as Windows, Mac OS, Linux, etc. HDF5 files can contain:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Datasets</span></code> - similar to spreadsheets and text files with tabular data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Groups</span></code> - similar to folders in a regular file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Attributes</span></code> - small metadata that provide additional information about the Group or Dataset they are attached to.</p></li>
<li><p>other advanced features such as hard links, soft links, object and region references, etc.</p></li>
</ul>
<p>h5py is the official software package for reading and writing to HDF5 files in python. Consequently, Pycroscopy relies entirely on h5py for all file related operations. While there are several high-level functions that simplify the reading and writing of Pycroscopy stylized data, it is still crucial that the users of Pycroscopy understand the basics of HDF5 files and are familiar with the basic functions in h5py. There are several tutorials available elsewhere to explain h5py in great detail.
This document serves as a quick primer to the basics of interacting with HDF5 files via h5py.</p>
</section>
<section id="Import-all-necessary-packages">
<h2>Import all necessary packages<a class="headerlink" href="#Import-all-necessary-packages" title="Link to this heading">¶</a></h2>
<p>For this primer, we only need some very basic packages, all of which come with the standard Anaconda distribution:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">os</span></code> - to manipulate and remove files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> - for basic numerical work</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h5py</span></code> - the package that will be the focus of this primer</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
</pre></div>
</div>
</div>
<p>Creating a HDF5 files using h5py is similar to the process of creating a conventional text file using python. The File class of h5py requires the path for the desired file with a .h5, .hdf5, or similar extension.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_path</span> <span class="o">=</span> <span class="s1">&#39;hdf5_primer.h5&#39;</span>
<span class="n">h5_file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;hdf5_primer.h5&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 file &#34;hdf5_primer.h5&#34; (mode r+)&gt;
</pre></div></div>
</div>
<p>At this point, a file in the path specified by h5_path has been created and is now open for modification. The returned value - h5_file is necessary to perform other operations on the file including creating groups and datasets.</p>
</section>
</section>
<section id="Groups">
<h1>Groups<a class="headerlink" href="#Groups" title="Link to this heading">¶</a></h1>
<section id="create_group()">
<h2>create_group()<a class="headerlink" href="#create_group()" title="Link to this heading">¶</a></h2>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">create_group()</span></code> function on an existing object such as the open file handle (<code class="docutils literal notranslate"><span class="pre">h5_file</span></code>) to create a group:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_group_1</span> <span class="o">=</span> <span class="n">h5_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;Group_1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_group_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 group &#34;/Group_1&#34; (0 members)&gt;
</pre></div></div>
</div>
<p>The output of the above print statement reveals that a group named <code class="docutils literal notranslate"><span class="pre">Group_1</span></code> was successfully created at location: ‘/’ (which stands for the root of the file). Furthermore, this group contains 0 objects or members. .name ——- One can find the full / absolute path where this object is located from its <code class="docutils literal notranslate"><span class="pre">name</span></code> property:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">h5_group_1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Group_1
</pre></div></div>
</div>
</section>
<section id="Groups-in-Groups">
<h2>Groups in Groups<a class="headerlink" href="#Groups-in-Groups" title="Link to this heading">¶</a></h2>
<p>Much like folders in a computer, these groups can themselves contain more groups and datasets.</p>
<p>Let us create a few more groups the same way. Except, let us create these groups within the newly created. To do this, we would need to call the <code class="docutils literal notranslate"><span class="pre">create_group()</span></code> function on the h5_group_1 object and not the h5_file object. Doing the latter would result in groups created under the file at the same level as <code class="docutils literal notranslate"><span class="pre">Group_1</span></code> instead of inside <code class="docutils literal notranslate"><span class="pre">Group_1</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_group_1_1</span> <span class="o">=</span> <span class="n">h5_group_1</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;Group_1_1&#39;</span><span class="p">)</span>
<span class="n">h5_group_1_2</span> <span class="o">=</span> <span class="n">h5_group_1</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;Group_1_2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now, when we print h5_group, it will reveal that we have two objects - the two groups we just created:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">h5_group_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 group &#34;/Group_1&#34; (2 members)&gt;
</pre></div></div>
</div>
<p>Lets see what a similar print of one of the newly created groups looks like:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">h5_group_1_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 group &#34;/Group_1/Group_1_1&#34; (0 members)&gt;
</pre></div></div>
</div>
<p>The above print statement shows that this group named <code class="docutils literal notranslate"><span class="pre">Group_1_1</span></code> exists at a path: <code class="docutils literal notranslate"><span class="pre">&quot;/Group_1/Group_1_1&quot;</span></code>. In other words, this is similar to a folder contained inside another folder.</p>
</section>
<section id=".parent">
<h2>.parent<a class="headerlink" href="#.parent" title="Link to this heading">¶</a></h2>
<p>The hierarchical nature of HDF5 allows us to access datasets and groups using relationships or paths. For example, every HDF5 object has a parent. In the case of ‘Group_1’ - its parent is the root or h5_file itself. Similarly, the parent object of ‘Group_1_1’ is ‘Group_1’:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Parent of &quot;Group_1&quot; is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h5_group_1</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Parent of &quot;Group_1_1&quot; is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h5_group_1_1</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Parent of &#34;Group_1&#34; is &lt;HDF5 group &#34;/&#34; (1 members)&gt;
Parent of &#34;Group_1_1&#34; is &lt;HDF5 group &#34;/Group_1&#34; (2 members)&gt;
</pre></div></div>
</div>
<p>In fact the .parent of an object is an HDF5 object (either a HDF5 group or HDF5 File object). So we can check if the parent of the h5_group_1_1 variable is indeed the h5_group_1 variable:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">h5_group_1_1</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">h5_group_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
</section>
<section id="Accessing-H5-objects">
<h2>Accessing H5 objects<a class="headerlink" href="#Accessing-H5-objects" title="Link to this heading">¶</a></h2>
<p>Imagine a file or a folder on a computer that is several folders deep from where one is (e.g. - /Users/Joe/Documents/Projects/2018/pycroscopy).One could either reach the desired file or folder by opening one folder after another or directly by using a long path string. If you were at root (/), you would need to paste the entire path (absolute path) of the desired file - <code class="docutils literal notranslate"><span class="pre">/Users/Joe/Documents/Projects/2018/pycroscopy</span></code>. Alternatively, if you were in an intermediate directory (e.g. -
<code class="docutils literal notranslate"><span class="pre">/Users/Joe/Documents/</span></code>), you would need to paste what is called the relative path (in this case - <code class="docutils literal notranslate"><span class="pre">Projects/2018/pycroscopy</span></code>) to get to the desired file.</p>
<p>In the same way, we can also access HDF5 objects either through <code class="docutils literal notranslate"><span class="pre">relative</span> <span class="pre">paths</span></code>, or <code class="docutils literal notranslate"><span class="pre">absolute</span> <span class="pre">paths</span></code>. Here are a few ways one could get to the group <code class="docutils literal notranslate"><span class="pre">Group_1_2</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">h5_file</span><span class="p">[</span><span class="s1">&#39;/Group_1/Group_1_2&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_group_1</span><span class="p">[</span><span class="s1">&#39;Group_1_2&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_group_1_1</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="s1">&#39;Group_1_2&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_group_1_1</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="s1">&#39;Group_1/Group_1_2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 group &#34;/Group_1/Group_1_2&#34; (0 members)&gt;
&lt;HDF5 group &#34;/Group_1/Group_1_2&#34; (0 members)&gt;
&lt;HDF5 group &#34;/Group_1/Group_1_2&#34; (0 members)&gt;
&lt;HDF5 group &#34;/Group_1/Group_1_2&#34; (0 members)&gt;
</pre></div></div>
</div>
<p>Now let us look at how one can iterate through the datasets and Groups present within a HDF5 group:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">h5_group_1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Group_1_1
Group_1_2
</pre></div></div>
</div>
</section>
<section id=".items()">
<h2>.items()<a class="headerlink" href="#.items()" title="Link to this heading">¶</a></h2>
<p>Essentially, h5py group objects contain a dictionary of key-value pairs where they key is the name of the object and the value is a reference to the object itself.</p>
<p>What the above for loop does is it iterates only over the keys in this dictionary which are all strings. In order to get the actual dataset object itself, we would need to use the aforementioned addressing techniques to get the actual Group objects.</p>
<p>Let us see how we would then try to find the object for the group named ‘Group_1_2’:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">h5_group_1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;Group_1_2&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found the desired object: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found the desired object: &lt;HDF5 group &#34;/Group_1/Group_1_2&#34; (0 members)&gt;
</pre></div></div>
</div>
</section>
</section>
<section id="Datasets">
<h1>Datasets<a class="headerlink" href="#Datasets" title="Link to this heading">¶</a></h1>
<section id="create_dataset()">
<h2>create_dataset()<a class="headerlink" href="#create_dataset()" title="Link to this heading">¶</a></h2>
<p>We can create a dataset within <code class="docutils literal notranslate"><span class="pre">Group_1</span></code> using a function that is similar to <code class="docutils literal notranslate"><span class="pre">create_group()</span></code>, called <code class="docutils literal notranslate"><span class="pre">create_dataset()</span></code>. Unlike create_group() which just takes the path of the desired group as an input, <code class="docutils literal notranslate"><span class="pre">create_dataset()</span></code> is highly customizable and flexible.</p>
<p>In our experience, there are three modes of creating datasets that are highly relevant for scientific applications:</p>
<ul class="simple">
<li><p>dataset with data at time of creation - where the data is already available at the time of creating the dataset</p></li>
<li><p>empty dataset - when one knows the size of data but the entire data is not available</p></li>
<li><p>resizable dataset - when one does not even know how large the data can be. <em>This case is rare</em></p></li>
</ul>
</section>
<section id="Creating-Dataset-with-available-data:">
<h2>Creating Dataset with available data:<a class="headerlink" href="#Creating-Dataset-with-available-data:" title="Link to this heading">¶</a></h2>
<p>Let as assume we want to store a simple greyscale (floating point values) image with 256 x 256 pixels. We would create and store the data as shown below. As the size of the dataset becomes very large, the precision with which the data is stored can significantly affect the size of the dataset and the file. Therefore, we recommend purposefully specifying the data-type (via the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> keyword argument) during creation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_simple_dataset</span> <span class="o">=</span> <span class="n">h5_group_1</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Simple_Dataset&#39;</span><span class="p">,</span>
                                              <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
                                              <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_simple_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 dataset &#34;Simple_Dataset&#34;: shape (256, 256), type &#34;&lt;f4&#34;&gt;
</pre></div></div>
</div>
</section>
<section id="Accessing-data">
<h2>Accessing data<a class="headerlink" href="#Accessing-data" title="Link to this heading">¶</a></h2>
<p>We can access data contained in the dataset just like accessing a numpy array. For example, if we want the value at row <code class="docutils literal notranslate"><span class="pre">29</span></code> and column <code class="docutils literal notranslate"><span class="pre">167</span></code>, we would read it as:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">h5_simple_dataset</span><span class="p">[</span><span class="mi">29</span><span class="p">,</span> <span class="mi">167</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.28895247
</pre></div></div>
</div>
<p>Again, just as before, we can address this dataset in many ways:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">h5_group_1</span><span class="p">[</span><span class="s1">&#39;Simple_Dataset&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_file</span><span class="p">[</span><span class="s1">&#39;/Group_1/Simple_Dataset&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 dataset &#34;Simple_Dataset&#34;: shape (256, 256), type &#34;&lt;f4&#34;&gt;
&lt;HDF5 dataset &#34;Simple_Dataset&#34;: shape (256, 256), type &#34;&lt;f4&#34;&gt;
</pre></div></div>
</div>
</section>
<section id="Creating-(potentially-large)-empty-datasets:">
<h2>Creating (potentially large) empty datasets:<a class="headerlink" href="#Creating-(potentially-large)-empty-datasets:" title="Link to this heading">¶</a></h2>
<p>In certain situations, we know how much space to allocate for the final dataset but we may not have all the data at once. Alternatively, the dataset is so large that we cannot fit the entire data in the computer memory before writing to the HDF5 file. Another possible circumstance is when we have to read N files, each containing a small portion of the data and then write the contents into each slot in the HDF5 dataset.</p>
<p>For example, assume that we have 128 files each having 1D spectra (amplitude + phase or complex value) of length 1024. Here is how one may create the HDF5 dataset to hold the data:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_empty_dataset</span> <span class="o">=</span> <span class="n">h5_group_1</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Empty_Dataset&#39;</span><span class="p">,</span>
                                             <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">1024</span><span class="p">),</span>
                                             <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_empty_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 dataset &#34;Empty_Dataset&#34;: shape (128, 1024), type &#34;&lt;c8&#34;&gt;
</pre></div></div>
</div>
<p>Note that unlike before, this particular dataset is empty since we only allocated space, so we would be reading zeros when attempting to access data:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">h5_empty_dataset</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">102</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0j
</pre></div></div>
</div>
</section>
<section id="populating-with-data">
<h2>populating with data<a class="headerlink" href="#populating-with-data" title="Link to this heading">¶</a></h2>
<p>One could populate each chunk of the dataset just like filling in a numpy array:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_empty_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="flush()">
<h2>flush()<a class="headerlink" href="#flush()" title="Link to this heading">¶</a></h2>
<p>It is a good idea to ensure that this data is indeed committed to the file using regular flush() operations. There are chances where the data is still in the memory / buffer and not yet in the file if one does not flush():</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Creating-resizeable-datasets:">
<h2>Creating resizeable datasets:<a class="headerlink" href="#Creating-resizeable-datasets:" title="Link to this heading">¶</a></h2>
<p>This solution is relevant to those situations where we only know how large each unit of data would be but we don’t know the number of units. This is especially relevant when acquiring data from an instrument.</p>
<p>For example, if we were acquiring spectra of length 128 on a 1D grid of 256 locations, we may have created an empty 2D dataset of shape (265, 128) using the aforementioned function. The data was being collected ordinarily over the first 13 positions but a change in parameters resulted in spectra of length 175 instead. The data from the 14th positon cannot be stored in the empty array due to a size mismatch. Therefore, we would need to create another empty 256 x 175 dataset to hold the data. If
changes in parameters cause 157 changes in spectra length, that would result in the creation of 157 datasets each with a whole lot of wasted space since datasets cannot be shrunk easily.</p>
<p>In such cases, it is easier just to create datasets that can expand one pixel at a time. For this specific example, one may want to create a 2D dataset of shape (1, 128) that could grow up to a maxshape of (256, 128) as shown below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_expandable_dset</span> <span class="o">=</span> <span class="n">h5_group_1</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Expandable_Dataset&#39;</span><span class="p">,</span>
                                               <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
                                               <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
                                               <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_expandable_dset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 dataset &#34;Expandable_Dataset&#34;: shape (1, 128), type &#34;&lt;f4&#34;&gt;
</pre></div></div>
</div>
<p>Space has been allocated for the first pixel, so the data could be written in as:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_expandable_dset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For the next pixel, we would need to expand the dataset before filling it in:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_expandable_dset</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">h5_expandable_dset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_expandable_dset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 dataset &#34;Expandable_Dataset&#34;: shape (2, 128), type &#34;&lt;f4&#34;&gt;
</pre></div></div>
</div>
<p>Notice how the dataset has increased in size in the first dimension allowing the second pixel to be stored. The second pixel’s data would be stored in the same way as in the first pixel and the cycle of expand and populate-with-data would continue.</p>
<p>It is very important to note that there is a non-trivial storage overhead associated with each resize operation. In other words, a file containing this resizeable dataset that has been resized 255 times will certainly be larger than a similar file where the dataset space was pre-allocated and never expanded. Therefore this mode of creating datasets should used sparingly.</p>
</section>
</section>
<section id="Attributes">
<h1>Attributes<a class="headerlink" href="#Attributes" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p>are metadata that can convey information that cannot be efficiently conveyed using Group or Dataset objects.</p></li>
<li><p>are almost exactly like python dictionaries in that they have a key-value pairs.</p></li>
<li><p>can be stored in either Group or Dataset objects.</p></li>
<li><p>are not appropriate for storing large amounts of information. Consider datasets instead</p></li>
<li><p>are best suited for things like experimental parameter such as beam intensity, scan rate, scan width, etc.</p></li>
</ul>
<section id="Writing">
<h2>Writing<a class="headerlink" href="#Writing" title="Link to this heading">¶</a></h2>
<p>Storing attributes in objects is identical to appending to python dictionaries. Lets store some simple attributes in the group named ‘Group_1’:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;single_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">36.23</span>
<span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;list_of_nums&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">6.534</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">],</span>
                               <span class="s1">&#39;single_string&#39;</span><span class="p">:</span> <span class="s1">&#39;hello&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</section>
<section id="Reading">
<h2>Reading<a class="headerlink" href="#Reading" title="Link to this heading">¶</a></h2>
<p>We would read the attributes just like we would treat a dictionary in python:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
list_of_nums : [  1.      6.534 -65.   ]
single_num : 36.23
single_string : hello
</pre></div></div>
</div>
<p>Lets read the attributes one by one and verify that we read what we wrote:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;single_num: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;single_num&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">36.23</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;list_of_nums: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;list_of_nums&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">6.534</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;single_string: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;single_string&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hello&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
single_num: True
list_of_nums: True
single_string: True
</pre></div></div>
</div>
</section>
<section id="Caveat">
<h2>Caveat<a class="headerlink" href="#Caveat" title="Link to this heading">¶</a></h2>
<p>While the low-level attribute writing and reading does appear to work and is simple, it does not work for a list of strings in python 3. Hence the following line will not work and will cause problems.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>h5_simple_dataset.attrs[&#39;list_of_strings&#39;] = [&#39;a&#39;, &#39;bc&#39;, &#39;def&#39;]
</pre></div>
</div>
<p>Instead, we recommend writing lists of strings by casting them as numpy arrays:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;list_of_strings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;bc&#39;</span><span class="p">,</span> <span class="s1">&#39;def&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In the same way, reading attributes that are lists of strings is also not straightforward:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;list_of_strings: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;list_of_strings&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;bc&#39;</span><span class="p">,</span> <span class="s1">&#39;def&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
list_of_strings: [False False False]
</pre></div></div>
</div>
<p>A similar decoding step needs to be taken to extract the actual string values.</p>
<p>To avoid manual encoding and decoding of attributes (different strategies for different versions of python), we recommend:</p>
<ul class="simple">
<li><p>writing attributes using: <code class="docutils literal notranslate"><span class="pre">pycroscopy.hdf_utils.write_simple_attrs()</span></code></p></li>
<li><p>reading attributes using: <code class="docutils literal notranslate"><span class="pre">pycroscopy.hdf_utils.get_attr()</span> <span class="pre">or</span> <span class="pre">get_attributes()</span></code></p></li>
</ul>
<p>Both these functions work reliably and consistently across all python versions and fix this problem in h5py.</p>
<p>Besides strings and numbers, we tend to store references to datasets as attributes. Here is how one would link the empty dataset to the simple dataset:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Dataset_Reference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5_empty_dataset</span><span class="o">.</span><span class="n">ref</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Dataset_Reference&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HDF5 object reference&gt;
</pre></div></div>
</div>
<p>Here is how one would get a handle to the actual dataset from the reference:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read the attribute how you normally would</span>
<span class="n">h5_ref</span> <span class="o">=</span> <span class="n">h5_simple_dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Dataset_Reference&#39;</span><span class="p">]</span>
<span class="c1"># Get the handle to the actual dataset:</span>
<span class="n">h5_dset</span> <span class="o">=</span> <span class="n">h5_file</span><span class="p">[</span><span class="n">h5_ref</span><span class="p">]</span>
<span class="c1"># Check if this object is indeed the empty dataset:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_empty_dataset</span> <span class="o">==</span> <span class="n">h5_dset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>Once we are done reading or manipulating an HDF5 file, we need to close it to avoid and potential damage:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">h5_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As mentioned in the beginning this is not meant to be a comprehensive overview of HDF5 or h5py, but rather just a quick overview of the important functionality we recommend everyone to be familiar with. We encourage you to read more about h5py and HDF5 if you are interested.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="HDF5 Tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hdf_utils_read.html" class="btn btn-neutral float-right" title="Utilities for reading h5USID files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Suhas Somnath, Gerd Duscher, and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>